from prepo import app

from fastapi.testclient import TestClient


client = TestClient(app)


def test_full_report():
    response = client.get("/fullreport", params={"path": "tests/test_data/titanic_truncated.csv"})
    assert response.status_code == 200
    assert response.json() == {
        "dataframe_report": {
            "path": "tests/test_data/titanic_truncated.csv",
            "num_rows": 49,
            "num_columns": 13,
            "column_names": [
                "PassengerId",
                "Survived",
                "Pclass",
                "Name",
                "Sex",
                "Age",
                "SibSp",
                "Parch",
                "Ticket",
                "Fare",
                "Cabin",
                "Embarked",
                "tpst",
            ],
            "dtypes": {
                "PassengerId": "Int64",
                "Survived": "Int64",
                "Pclass": "Int64",
                "Name": "String",
                "Sex": "String",
                "Age": "Int64",
                "SibSp": "Int64",
                "Parch": "Int64",
                "Ticket": "String",
                "Fare": "Float64",
                "Cabin": "String",
                "Embarked": "String",
                "tpst": "String",
            },
            "missing_values": {
                "PassengerId": 0,
                "Survived": 0,
                "Pclass": 0,
                "Name": 0,
                "Sex": 0,
                "Age": 14,
                "SibSp": 0,
                "Parch": 0,
                "Ticket": 0,
                "Fare": 0,
                "Cabin": 40,
                "Embarked": 0,
                "tpst": 0,
            },
        },
        "covariance_report": {
            "covariance_matrix": {
                "PassengerId": {
                    "Survived": -0.875,
                    "Pclass": 1.4791666666666667,
                    "Name": None,
                    "Sex": None,
                    "Age": -15.899159663865548,
                    "SibSp": 0.12499999999999971,
                    "Parch": -1.6041666666666663,
                    "Ticket": -555282.0105105105,
                    "Fare": -3.823274999999995,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": -827.75,
                },
                "Survived": {
                    "PassengerId": -0.875,
                    "Pclass": -0.05059523809523808,
                    "Name": None,
                    "Sex": None,
                    "Age": -0.23949579831932782,
                    "SibSp": -0.14200680272108843,
                    "Parch": 0.021258503401360554,
                    "Ticket": -8929.145645645649,
                    "Fare": -0.8228830782312923,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": -266.4,
                },
                "Pclass": {
                    "PassengerId": 1.4791666666666667,
                    "Survived": -0.05059523809523808,
                    "Name": None,
                    "Sex": None,
                    "Age": -6.600840336134454,
                    "SibSp": -0.0029761904761904864,
                    "Parch": 0.1130952380952381,
                    "Ticket": 46908.363363363365,
                    "Fare": -20.910957142857143,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": -1.299999999999983,
                },
                "Name": {
                    "PassengerId": None,
                    "Survived": None,
                    "Pclass": None,
                    "Sex": None,
                    "Age": None,
                    "SibSp": None,
                    "Parch": None,
                    "Ticket": None,
                    "Fare": None,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": None,
                },
                "Sex": {
                    "PassengerId": None,
                    "Survived": None,
                    "Pclass": None,
                    "Name": None,
                    "Age": None,
                    "SibSp": None,
                    "Parch": None,
                    "Ticket": None,
                    "Fare": None,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": None,
                },
                "Age": {
                    "PassengerId": -15.899159663865548,
                    "Survived": -0.23949579831932782,
                    "Pclass": -6.600840336134454,
                    "Name": None,
                    "Sex": None,
                    "SibSp": -8.780672268907566,
                    "Parch": -1.6428571428571423,
                    "Ticket": -795910.6550000001,
                    "Fare": -7.152230252100842,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": -104.29999999999983,
                },
                "SibSp": {
                    "PassengerId": 0.12499999999999971,
                    "Survived": -0.14200680272108843,
                    "Pclass": -0.0029761904761904864,
                    "Name": None,
                    "Sex": None,
                    "Age": -8.780672268907566,
                    "Parch": 0.3235544217687074,
                    "Ticket": 11858.371621621623,
                    "Fare": 17.13572538265306,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": 240.10000000000002,
                },
                "Parch": {
                    "PassengerId": -1.6041666666666663,
                    "Survived": 0.021258503401360554,
                    "Pclass": 0.1130952380952381,
                    "Name": None,
                    "Sex": None,
                    "Age": -1.6428571428571423,
                    "SibSp": 0.3235544217687074,
                    "Ticket": 44463.576576576575,
                    "Fare": 9.805908375850338,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": 0.0,
                },
                "Ticket": {
                    "PassengerId": -555282.0105105105,
                    "Survived": -8929.145645645649,
                    "Pclass": 46908.363363363365,
                    "Name": None,
                    "Sex": None,
                    "Age": -795910.6550000001,
                    "SibSp": 11858.371621621623,
                    "Parch": 44463.576576576575,
                    "Fare": -1678015.0464553304,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": 118399032.0,
                },
                "Fare": {
                    "PassengerId": -3.823274999999995,
                    "Survived": -0.8228830782312923,
                    "Pclass": -20.910957142857143,
                    "Name": None,
                    "Sex": None,
                    "Age": -7.152230252100842,
                    "SibSp": 17.13572538265306,
                    "Parch": 9.805908375850338,
                    "Ticket": -1678015.0464553304,
                    "Cabin": None,
                    "Embarked": None,
                    "tpst": 3538.6753599999975,
                },
                "Cabin": {
                    "PassengerId": None,
                    "Survived": None,
                    "Pclass": None,
                    "Name": None,
                    "Sex": None,
                    "Age": None,
                    "SibSp": None,
                    "Parch": None,
                    "Ticket": None,
                    "Fare": None,
                    "Embarked": None,
                    "tpst": None,
                },
                "Embarked": {
                    "PassengerId": None,
                    "Survived": None,
                    "Pclass": None,
                    "Name": None,
                    "Sex": None,
                    "Age": None,
                    "SibSp": None,
                    "Parch": None,
                    "Ticket": None,
                    "Fare": None,
                    "Cabin": None,
                    "tpst": None,
                },
                "tpst": {
                    "PassengerId": -827.75,
                    "Survived": -266.4,
                    "Pclass": -1.299999999999983,
                    "Name": None,
                    "Sex": None,
                    "Age": -104.29999999999983,
                    "SibSp": 240.10000000000002,
                    "Parch": 0.0,
                    "Ticket": 118399032.0,
                    "Fare": 3538.6753599999975,
                    "Cabin": None,
                    "Embarked": None,
                },
            }
        },
        "column_reports": [
            {
                "name": "PassengerId",
                "mean": 25.0,
                "median": 25.0,
                "std_dev": 14.288690166235206,
                "min_value": 1.0,
                "max_value": 49.0,
                "count": 49,
                "unique_count": 49,
                "null_count": 0,
            },
            {
                "name": "Survived",
                "mean": 0.4489795918367347,
                "median": 0.0,
                "std_dev": 0.5025445456953673,
                "min_value": 0.0,
                "max_value": 1.0,
                "count": 49,
                "unique_count": 2,
                "null_count": 0,
            },
            {
                "name": "Pclass",
                "mean": 2.4285714285714284,
                "median": 3.0,
                "std_dev": 0.816496580927726,
                "min_value": 1.0,
                "max_value": 3.0,
                "count": 49,
                "unique_count": 3,
                "null_count": 0,
            },
            {"name": "Name", "count": 49, "unique_count": 49, "null_count": 0},
            {"name": "Sex", "count": 49, "unique_count": 2, "null_count": 0},
            {
                "name": "Age",
                "mean": 27.742857142857144,
                "median": 27.0,
                "std_dev": 16.15247724060936,
                "min_value": 2.0,
                "max_value": 66.0,
                "count": 49,
                "unique_count": 26,
                "null_count": 14,
            },
            {
                "name": "SibSp",
                "mean": 0.673469387755102,
                "median": 0.0,
                "std_dev": 0.9658276912843722,
                "min_value": 0.0,
                "max_value": 4.0,
                "count": 49,
                "unique_count": 5,
                "null_count": 0,
            },
            {
                "name": "Parch",
                "mean": 0.40816326530612246,
                "median": 0.0,
                "std_dev": 1.0976939340221916,
                "min_value": 0.0,
                "max_value": 5.0,
                "count": 49,
                "unique_count": 4,
                "null_count": 0,
            },
            {"name": "Ticket", "count": 49, "unique_count": 48, "null_count": 0},
            {
                "name": "Fare",
                "mean": 28.101444897959183,
                "median": 15.5,
                "std_dev": 42.316295419407,
                "min_value": 7.225,
                "max_value": 263.0,
                "count": 49,
                "unique_count": 39,
                "null_count": 0,
            },
            {"name": "Cabin", "count": 49, "unique_count": 10, "null_count": 40},
            {"name": "Embarked", "count": 49, "unique_count": 3, "null_count": 0},
            {"name": "tpst", "count": 49, "unique_count": 48, "null_count": 0},
        ],
    }
